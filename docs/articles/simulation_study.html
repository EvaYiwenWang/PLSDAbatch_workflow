<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation Study • PLSDAbatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulation Study">
<meta property="og:description" content="PLSDAbatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PLSDAbatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/case_studies.html">Case Studies</a>
    </li>
    <li>
      <a href="../articles/simulation_study.html">Simulation Study</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simulation_study_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulation Study</h1>
                        <h4 class="author">Yiwen (Eva) Wang</h4>
                        <h4 class="author">Melbourne Integrative Genomics, School of Mathematics and Statistics, The University of Melbourne, Australia</h4>
                        <h4 class="author"><a href="mailto:yiwenw5@student.unimelb.edu.au" class="email">yiwenw5@student.unimelb.edu.au</a></h4>
            
            <h4 class="date">01 December, 2021</h4>
      
      
      <div class="hidden name"><code>simulation_study.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>We adapted the simulation strategy that is component-based and multivariate from <span class="citation">(<a href="#ref-singh2019diablo" role="doc-biblioref">Singh et al. 2019</a>)</span>. We assumed the input data are Centered Log Ratio (CLR) transformed with a Gaussian-like distribution (see “Case studies”). Thus, we simulated components from a Gaussian distribution across all samples. The data matrix was generated based on the simulated components and corresponding loading vectors for each variable. Each simulated dataset included 300 variables and 40 samples grouped according to two treatments (trt1 and trt2) and two batches (batch1 and batch2). Different parameters including amount of batch and treatment variability, number of variables with batch and/or treatment effects, balanced and unbalanced batch <span class="math inline">\(\times\)</span> treatment designs were considered and summarised in the table below.</p>
<p><strong>Table 1: Summary of simulations.</strong> For a given choice of parameters listed, each simulation was repeated 50 times. <span class="math inline">\(\mu_{(trt)}\)</span> and <span class="math inline">\(\mu_{(batch)}\)</span> represent the size of treatment and batch effects, <span class="math inline">\(\sigma_{(trt)}\)</span> and <span class="math inline">\(\sigma_{(batch)}\)</span> refer to the variability of treatment and batch effects, <span class="math inline">\(p^{(trt)}, p^{(batch)}\)</span> and <span class="math inline">\(p^{(trt \ \&amp; \ batch)}\)</span> represent the number of variables with treatment, batch, or both effects respectively. <strong>Simulation 6</strong> includes parameters reflective of real data.</p>
<table class="table">
<colgroup>
<col width="8%">
<col width="11%">
<col width="13%">
<col width="12%">
<col width="14%">
<col width="9%">
<col width="11%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">Parameters</th>
<th align="center"><span class="math inline">\(\mu_{(trt)}\)</span></th>
<th align="center"><span class="math inline">\(\sigma_{(trt)}\)</span></th>
<th align="center"><span class="math inline">\(\mu_{(batch)}\)</span></th>
<th align="center"><span class="math inline">\(\sigma_{(batch)}\)</span></th>
<th align="center"><span class="math inline">\(p^{(trt)}\)</span></th>
<th align="center"><span class="math inline">\(p^{(batch)}\)</span></th>
<th align="center"><span class="math inline">\(p^{(trt \ \&amp; \ batch)}\)</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Simulation 1</td>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">{1,4,8}</td>
<td align="center">60</td>
<td align="center">150</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">Simulation 2</td>
<td align="center">{3,5,7}</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">60</td>
<td align="center">150</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">Simulation 3</td>
<td align="center">3</td>
<td align="center">{1,2,4}</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">60</td>
<td align="center">150</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">Simulation 4</td>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">{30,60,100,150}</td>
<td align="center">150</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">Simulation 5</td>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">60</td>
<td align="center">{30,60,100,150}</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center"><strong>Simulation 6</strong></td>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">60</td>
<td align="center">150</td>
<td align="center">{0,18,30,42,60}</td>
</tr>
</tbody>
</table>
<p>The scenario indicated in bold is likely to be encountered in real data, where a few variables are relevant to treatment effects, while a large number with batch effects that are stronger and more variable than treatment effects. A subset of variables are influenced by both effects.</p>
<p>In addition to the data with batch effects, we also simulated a ground-truth dataset that only included the background noise and treatment but no batch effect to evaluate batch corrected datasets.</p>
<p>For the PLSDA-batch analyses, we chose <span class="math inline">\(C-1\)</span> (or <span class="math inline">\(B-1\)</span>) components associated with treatment (or batch) effects (where <span class="math inline">\(C\)</span> or <span class="math inline">\(B\)</span> represents the total number of treatment or batch groups) as <span class="math inline">\(C-1\)</span> (or <span class="math inline">\(B-1\)</span>) components are likely to explain 100% variance in <strong>Y</strong>, and the number of variables with a true treatment effect (<span class="math inline">\(p^{(trt)}\)</span>) as the optimal number to select on each treatment component in sPLSDA-batch.</p>
</div>
<div id="packages-installation-and-loading" class="section level1">
<h1 class="hasAnchor">
<a href="#packages-installation-and-loading" class="anchor"></a>Packages installation and loading</h1>
<p>Install then load the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">PLSDAbatch</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.mixOmics.org">mixOmics</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sva</span><span class="op">)</span> <span class="co">#ComBat</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioinf.wehi.edu.au/limma">limma</a></span><span class="op">)</span> <span class="co">#removeBatchEffect</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org">vegan</a></span><span class="op">)</span> <span class="co">#RDA</span></code></pre></div>
</div>
<div id="simulations" class="section level1">
<h1 class="hasAnchor">
<a href="#simulations" class="anchor"></a>Simulations</h1>
<div id="balanced-batch-times-treatment-design" class="section level2">
<h2 class="hasAnchor">
<a href="#balanced-batch-times-treatment-design" class="anchor"></a>Balanced batch <span class="math inline">\(\times\)</span> treatment design</h2>
<p>The balanced batch <span class="math inline">\(\times\)</span> treatment experimental design included 10 samples from two batches respectively in each treatment group (see Table 2)</p>
<p><strong>Table 2: Balanced batch <span class="math inline">\(\times\)</span> treatment design</strong> in the simulation study</p>
<table class="table">
<thead><tr class="header">
<th align="center"></th>
<th align="center">Trt1</th>
<th align="center">Trt2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Batch1</td>
<td align="center">10</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">Batch2</td>
<td align="center">10</td>
<td align="center">10</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nitr</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">p_total</span> <span class="op">&lt;-</span> <span class="fl">300</span>
<span class="va">p_trt_relevant</span> <span class="op">&lt;-</span> <span class="fl">60</span>
<span class="va">p_bat_relevant</span> <span class="op">&lt;-</span> <span class="fl">150</span>

<span class="co"># global variance (RDA)</span>
<span class="va">gvar.before</span> <span class="op">&lt;-</span> <span class="va">gvar.clean</span> <span class="op">&lt;-</span> <span class="va">gvar.rbe</span> <span class="op">&lt;-</span> <span class="va">gvar.combat</span> <span class="op">&lt;-</span> 
  <span class="va">gvar.plsdab</span> <span class="op">&lt;-</span> <span class="va">gvar.splsdab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="cn">NA</span>, intersection <span class="op">=</span> <span class="cn">NA</span>, 
                                            batch <span class="op">=</span> <span class="cn">NA</span>,  residual <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="co"># individual variance (R2)</span>
<span class="va">r2.trt.before</span> <span class="op">&lt;-</span> <span class="va">r2.trt.clean</span> <span class="op">&lt;-</span> <span class="va">r2.trt.rbe</span>  <span class="op">&lt;-</span> <span class="va">r2.trt.combat</span> <span class="op">&lt;-</span> 
  <span class="va">r2.trt.plsdab</span> <span class="op">&lt;-</span> <span class="va">r2.trt.splsdab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">p_total</span>, 
                                                       ncol <span class="op">=</span> <span class="va">nitr</span><span class="op">)</span><span class="op">)</span>
<span class="va">r2.batch.before</span> <span class="op">&lt;-</span> <span class="va">r2.batch.clean</span> <span class="op">&lt;-</span> <span class="va">r2.batch.rbe</span>  <span class="op">&lt;-</span> <span class="va">r2.batch.combat</span> <span class="op">&lt;-</span> 
  <span class="va">r2.batch.plsdab</span> <span class="op">&lt;-</span> <span class="va">r2.batch.splsdab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">p_total</span>, 
                                                           ncol <span class="op">=</span> <span class="va">nitr</span><span class="op">)</span><span class="op">)</span>

<span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
<span class="va">precision_limma</span> <span class="op">&lt;-</span> <span class="va">recall_limma</span> <span class="op">&lt;-</span> <span class="va">F1_limma</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>before <span class="op">=</span> <span class="cn">NA</span>, clean <span class="op">=</span> <span class="cn">NA</span>, rbe <span class="op">=</span> <span class="cn">NA</span>, combat <span class="op">=</span> <span class="cn">NA</span>, 
             plsda_batch <span class="op">=</span> <span class="cn">NA</span>, splsda_batch <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
<span class="va">precision_splsda</span> <span class="op">&lt;-</span> <span class="va">recall_splsda</span> <span class="op">&lt;-</span> <span class="va">F1_splsda</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>before <span class="op">=</span> <span class="cn">NA</span>, clean <span class="op">=</span> <span class="cn">NA</span>, rbe <span class="op">=</span> <span class="cn">NA</span>, combat <span class="op">=</span> <span class="cn">NA</span>, 
             plsda_batch <span class="op">=</span> <span class="cn">NA</span>, splsda_batch <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">nitr</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">### initial setup ###</span>
  <span class="va">simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simData.html">simData</a></span><span class="op">(</span>bat.mean <span class="op">=</span> <span class="fl">7</span>, sd.bat <span class="op">=</span> <span class="fl">8</span>, trt.mean <span class="op">=</span> <span class="fl">3</span>, sd.trt <span class="op">=</span> <span class="fl">2</span>, 
                        N <span class="op">=</span> <span class="fl">40</span>, p_total <span class="op">=</span> <span class="fl">300</span>, p_trt_relevant <span class="op">=</span> <span class="fl">60</span>, 
                        p_bat_relevant <span class="op">=</span> <span class="fl">150</span>, percentage_samples <span class="op">=</span> <span class="fl">0.5</span>,
                        percentage_overlap_variables <span class="op">=</span> <span class="fl">0.5</span>, seeds <span class="op">=</span> <span class="va">i</span><span class="op">)</span>
  
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">data</span>
  <span class="va">trt</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">Y.trt</span>
  <span class="va">batch</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">Y.bat</span>
  <span class="va">true.trt</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">true.trt</span>
  <span class="va">true.batch</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">true.batch</span>
  
  <span class="va">Batch_Trt.factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Batch <span class="op">=</span> <span class="va">batch</span>, Treatment <span class="op">=</span> <span class="va">trt</span><span class="op">)</span>
  
  <span class="co">### Before correction ###</span>
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.before</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                       data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.before</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.before</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.before</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.before</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.before</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.before</span>
  <span class="va">r2.batch.before</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.before</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>, design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.before</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.before</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.before</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.before</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> 
                                                  <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.before</span><span class="op">)</span>
  <span class="va">recall_limma.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.before</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.before</span><span class="op">*</span><span class="va">recall_limma.before</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.before</span> <span class="op">+</span> <span class="va">recall_limma.before</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.before</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.before</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.before</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.before</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.before_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                              keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.before_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.before</span><span class="op">)</span>
  <span class="va">recall_splsda.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.before</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.before</span><span class="op">*</span><span class="va">recall_splsda.before</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.before</span> <span class="op">+</span> <span class="va">recall_splsda.before</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.before</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.before</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">#############################################################################</span>
  <span class="co">### Ground-truth data ###</span>
  <span class="va">X.clean</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">cleanData</span>
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.clean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                      data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.clean</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.clean</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.clean</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.clean</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.clean</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.clean</span>
  <span class="va">r2.batch.clean</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.clean</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">)</span>, 
                     design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.clean</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.clean</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.clean</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.clean</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> 
                                                <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.clean</span><span class="op">)</span>
  <span class="va">recall_limma.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.clean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.clean</span><span class="op">*</span><span class="va">recall_limma.clean</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.clean</span> <span class="op">+</span> <span class="va">recall_limma.clean</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.clean</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.clean</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.clean</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.clean</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.clean_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.clean</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                             keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.clean_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.clean</span><span class="op">)</span>
  <span class="va">recall_splsda.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.clean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.clean</span><span class="op">*</span><span class="va">recall_splsda.clean</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.clean</span> <span class="op">+</span> <span class="va">recall_splsda.clean</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.clean</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.clean</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">############################################################################</span>
  <span class="co">### removeBatchEffect corrected data ###</span>
  <span class="va">X.rbe</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/removeBatchEffect.html">removeBatchEffect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, batch <span class="op">=</span> <span class="va">batch</span>, 
                              design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.rbe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                    data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.rbe</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.rbe</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.rbe</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.rbe</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.rbe</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.rbe</span>
  <span class="va">r2.batch.rbe</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.rbe</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">)</span>, 
                   design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.rbe</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.rbe</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.rbe</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.rbe</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.rbe</span><span class="op">)</span>
  <span class="va">recall_limma.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.rbe</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.rbe</span><span class="op">*</span><span class="va">recall_limma.rbe</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.rbe</span> <span class="op">+</span> <span class="va">recall_limma.rbe</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.rbe</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.rbe</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.rbe</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.rbe</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.rbe_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.rbe</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                           keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.rbe_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.rbe</span><span class="op">)</span>
  <span class="va">recall_splsda.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.rbe</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.rbe</span><span class="op">*</span><span class="va">recall_splsda.rbe</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.rbe</span> <span class="op">+</span> <span class="va">recall_splsda.rbe</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.rbe</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.rbe</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###########################################################################</span>
  <span class="co">### ComBat corrected data ###</span>
  <span class="va">X.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sva/man/ComBat.html">ComBat</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, batch <span class="op">=</span> <span class="va">batch</span>, 
                       mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.combat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                       data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.combat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.combat</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.combat</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.combat</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.combat</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.combat</span>
  <span class="va">r2.batch.combat</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.combat</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">)</span>, 
                      design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.combat</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.combat</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.combat</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.combat</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> 
                                                  <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.combat</span><span class="op">)</span>
  <span class="va">recall_limma.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.combat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.combat</span><span class="op">*</span><span class="va">recall_limma.combat</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.combat</span> <span class="op">+</span> <span class="va">recall_limma.combat</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.combat</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.combat</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.combat</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.combat</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.combat_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.combat</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                              keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.combat_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.combat</span><span class="op">)</span>
  <span class="va">recall_splsda.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.combat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.combat</span><span class="op">*</span><span class="va">recall_splsda.combat</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.combat</span> <span class="op">+</span> <span class="va">recall_splsda.combat</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.combat</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.combat</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">############################################################################</span>
  <span class="co">### PLSDA-batch corrected data ###</span>
  <span class="va">X.plsda_batch.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLSDA_batch.html">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, 
                                       Y.trt <span class="op">=</span> <span class="va">trt</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>, 
                                       ncomp.trt <span class="op">=</span> <span class="fl">1</span>, ncomp.bat <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">X.plsda_batch</span> <span class="op">&lt;-</span> <span class="va">X.plsda_batch.correct</span><span class="op">$</span><span class="va">X.nobatch</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.plsda_batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                            data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.plsdab</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.plsda_batch</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.plsda_batch</span>, 
                               <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.plsda_batch</span>, 
                                 <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.plsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.plsda_batch</span>
  <span class="va">r2.batch.plsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.plsda_batch</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span><span class="op">)</span>, 
                           design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.plsda_batch</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.plsda_batch</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.plsda_batch</span><span class="op">)</span><span class="op">[</span>
    <span class="va">fit.result.plsda_batch</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.plsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.plsda_batch</span><span class="op">)</span>
  <span class="va">recall_limma.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.plsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.plsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.plsda_batch</span><span class="op">*</span><span class="va">recall_limma.plsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.plsda_batch</span> <span class="op">+</span> <span class="va">recall_limma.plsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.plsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.plsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.plsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.plsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.plsda_batch_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.plsda_batch</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                                   keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.plsda_batch_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.plsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.plsda_batch</span><span class="op">)</span>
  <span class="va">recall_splsda.plsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.plsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.plsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.plsda_batch</span><span class="op">*</span><span class="va">recall_splsda.plsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.plsda_batch</span> <span class="op">+</span> <span class="va">recall_splsda.plsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.plsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.plsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### sPLSDA-batch corrected data ###</span>
  <span class="va">X.splsda_batch.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLSDA_batch.html">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, 
                                        Y.trt <span class="op">=</span> <span class="va">trt</span>, 
                                        Y.bat <span class="op">=</span> <span class="va">batch</span>, 
                                        ncomp.trt <span class="op">=</span> <span class="fl">1</span>, 
                                        keepX.trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>, 
                                        ncomp.bat <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">X.splsda_batch</span> <span class="op">&lt;-</span> <span class="va">X.splsda_batch.correct</span><span class="op">$</span><span class="va">X.nobatch</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.splsda_batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                             data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.splsdab</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.splsda_batch</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.splsda_batch</span>, 
                                <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.splsda_batch</span>, 
                                  <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.splsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.splsda_batch</span>
  <span class="va">r2.batch.splsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.splsda_batch</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span><span class="op">)</span>, 
                            design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.splsda_batch</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.splsda_batch</span><span class="op">)</span>, 
                                      number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.splsda_batch</span><span class="op">)</span><span class="op">[</span>
    <span class="va">fit.result.splsda_batch</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.splsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.splsda_batch</span><span class="op">)</span>
  <span class="va">recall_limma.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.splsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.splsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.splsda_batch</span><span class="op">*</span><span class="va">recall_limma.splsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.splsda_batch</span> <span class="op">+</span> <span class="va">recall_limma.splsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.splsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.splsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.splsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.splsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.splsda_batch_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.splsda_batch</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                                    keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.splsda_batch_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.splsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.splsda_batch</span><span class="op">)</span>
  <span class="va">recall_splsda.splsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.splsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.splsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.splsda_batch</span><span class="op">*</span><span class="va">recall_splsda.splsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.splsda_batch</span> <span class="op">+</span> <span class="va">recall_splsda.splsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.splsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.splsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># summary</span>
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">precision_limma</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">precision_limma.before</span>, 
                            `Ground-truth data` <span class="op">=</span> <span class="va">precision_limma.clean</span>,
                            `removeBatchEffect` <span class="op">=</span> <span class="va">precision_limma.rbe</span>,
                            ComBat <span class="op">=</span> <span class="va">precision_limma.combat</span>,
                            `PLSDA-batch` <span class="op">=</span> <span class="va">precision_limma.plsda_batch</span>,
                            `sPLSDA-batch` <span class="op">=</span> <span class="va">precision_limma.splsda_batch</span><span class="op">)</span>
  
  <span class="va">recall_limma</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">recall_limma.before</span>, 
                         `Ground-truth data` <span class="op">=</span> <span class="va">recall_limma.clean</span>,
                         `removeBatchEffect` <span class="op">=</span> <span class="va">recall_limma.rbe</span>,
                         ComBat <span class="op">=</span> <span class="va">recall_limma.combat</span>,
                         `PLSDA-batch` <span class="op">=</span> <span class="va">recall_limma.plsda_batch</span>,
                         `sPLSDA-batch` <span class="op">=</span> <span class="va">recall_limma.splsda_batch</span><span class="op">)</span>
  
  <span class="va">F1_limma</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">F1_limma.before</span>, 
                     `Ground-truth data` <span class="op">=</span> <span class="va">F1_limma.clean</span>,
                     `removeBatchEffect` <span class="op">=</span> <span class="va">F1_limma.rbe</span>,
                     ComBat <span class="op">=</span> <span class="va">F1_limma.combat</span>,
                     `PLSDA-batch` <span class="op">=</span> <span class="va">F1_limma.plsda_batch</span>,
                     `sPLSDA-batch` <span class="op">=</span> <span class="va">F1_limma.splsda_batch</span><span class="op">)</span>
  
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">precision_splsda</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">precision_splsda.before</span>, 
                             `Ground-truth data` <span class="op">=</span> <span class="va">precision_splsda.clean</span>,
                             `removeBatchEffect` <span class="op">=</span> <span class="va">precision_splsda.rbe</span>,
                             ComBat <span class="op">=</span> <span class="va">precision_splsda.combat</span>,
                             `PLSDA-batch` <span class="op">=</span> <span class="va">precision_splsda.plsda_batch</span>,
                             `sPLSDA-batch` <span class="op">=</span> <span class="va">precision_splsda.splsda_batch</span><span class="op">)</span>
  
  <span class="va">recall_splsda</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">recall_splsda.before</span>, 
                          `Ground-truth data` <span class="op">=</span> <span class="va">recall_splsda.clean</span>,
                          `removeBatchEffect` <span class="op">=</span> <span class="va">recall_splsda.rbe</span>,
                          ComBat <span class="op">=</span> <span class="va">recall_splsda.combat</span>,
                          `PLSDA-batch` <span class="op">=</span> <span class="va">recall_splsda.plsda_batch</span>,
                          `sPLSDA-batch` <span class="op">=</span> <span class="va">recall_splsda.splsda_batch</span><span class="op">)</span>
  
  <span class="va">F1_splsda</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">F1_splsda.before</span>, 
                      `Ground-truth data` <span class="op">=</span> <span class="va">F1_splsda.clean</span>,
                      `removeBatchEffect` <span class="op">=</span> <span class="va">F1_splsda.rbe</span>,
                      ComBat <span class="op">=</span> <span class="va">F1_splsda.combat</span>,
                      `PLSDA-batch` <span class="op">=</span> <span class="va">F1_splsda.plsda_batch</span>,
                      `sPLSDA-batch` <span class="op">=</span> <span class="va">F1_splsda.splsda_batch</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<p>As the simulation step takes time, so we use the saved data into visulisation.</p>
</div>
<div id="figures" class="section level2">
<h2 class="hasAnchor">
<a href="#figures" class="anchor"></a>Figures</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># global variance (RDA)</span>
<span class="va">prop.gvar.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.before</span><span class="op">)</span>,
                       `Ground-truth data` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.clean</span><span class="op">)</span>,
                       removeBatchEffect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.rbe</span><span class="op">)</span>,
                       ComBat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.combat</span><span class="op">)</span>,
                       `PLSDA-batch` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.plsdab</span><span class="op">)</span>,
                       `sPLSDA-batch` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.splsdab</span><span class="op">)</span><span class="op">)</span>

<span class="va">prop.gvar.all</span><span class="op">[</span><span class="va">prop.gvar.all</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">prop.gvar.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">prop.gvar.all</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">prop.gvar.all</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Treatment'</span>, <span class="st">'Intersection'</span>, <span class="st">'Batch'</span>, <span class="st">'Residuals'</span><span class="op">)</span>

<span class="fu"><a href="../reference/partVar_plot.html">partVar_plot</a></span><span class="op">(</span>prop.df <span class="op">=</span> <span class="va">prop.gvar.all</span><span class="op">)</span></code></pre></div>
<p><img src="simulation_study_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>We first considered the proportion of variance explained by treatment and batch effects before and after batch correction across all variables using pRDA. Efficient batch correction methods should generate data with a smaller proportion of batch associated variance and larger proportion of treatment variance compared to the original data. The figure shows that there was no intersection shared between treatment and batch variation with a balanced batch <span class="math inline">\(\times\)</span> treatment design. All methods successfully removed batch variation, but PLSDA-batch and sPLSDA-batch preserved more proportion of treatment variance than removeBatchEffect and ComBat. In addition, the data corrected by sPLSDA-batch included almost as much proportion of treatment variance as the ground-truth data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">###############################################################################</span>
<span class="co"># individual variance (R2)</span>
<span class="co"># color</span>
<span class="va">gcolor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span>, <span class="va">p_trt_relevant</span><span class="op">)</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span>, <span class="op">(</span><span class="va">p_total</span> <span class="op">-</span> <span class="va">p_trt_relevant</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">gcolor</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">true.batch</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span>
<span class="va">gcolor</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">true.batch</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>

<span class="va">xlabs</span> <span class="op">=</span> <span class="st">'R2(variable, treatment)'</span>
<span class="va">ylabs</span> <span class="op">=</span> <span class="st">'R2(variable, batch)'</span>
<span class="va">edgex</span> <span class="op">=</span> <span class="fl">0.7</span>
<span class="va">edgey</span> <span class="op">=</span> <span class="fl">0.5</span>

<span class="co"># scatterplot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.before</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.before</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, 
     main <span class="op">=</span> <span class="st">'Before correction'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.clean</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.clean</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, 
     main <span class="op">=</span> <span class="st">'Ground-truth data'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.rbe</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.rbe</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, 
     main <span class="op">=</span> <span class="st">'removeBatchEffect'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.combat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.combat</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'ComBat'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.plsdab</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.plsdab</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'PLSDA-batch'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.splsdab</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.splsdab</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'sPLSDA-batch'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="simulation_study_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We also estimated the proportion of variance explained by treatment and batch effects for each variable respectively using the <span class="math inline">\(R^2\)</span> value. The variables assigned with both treatment and batch effects in the corrected data from removeBatchEffect and ComBat presented less proportion of treatment associated variance than in the ground truth data. This result agrees with the pRDA evaluation that these two methods do not preserve enough treatment variation. With PLSDA-batch, variables with only batch effects displayed some amount of treatment variation, but only in the case where the batch effect variability was high (results not shown). sPLSDA-batch outperformed all methods, with results similar to the ground-truth data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># precision &amp; recall &amp; F1 (ANOVA &amp; sPLSDA)</span>
<span class="co">## mean</span>
<span class="va">acc_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">precision_limma</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">recall_limma</span><span class="op">)</span>, 
                  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">F1_limma</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">precision_splsda</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">acc_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Precision'</span>, <span class="st">'Recall'</span>, <span class="st">'F1'</span>, <span class="st">'Multivariate selection'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">acc_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Before correction'</span>, <span class="st">'Ground-truth data'</span>, 
                        <span class="st">'removeBatchEffect'</span>, <span class="st">'ComBat'</span>, 
                        <span class="st">'PLSDA-batch'</span>, <span class="st">'sPLSDA-batch'</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">acc_mean</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="20%">
<col width="16%">
<col width="16%">
<col width="16%">
<col width="8%">
<col width="10%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Before correction</th>
<th align="right">Ground-truth data</th>
<th align="right">removeBatchEffect</th>
<th align="right">ComBat</th>
<th align="right">PLSDA-batch</th>
<th align="right">sPLSDA-batch</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Precision</td>
<td align="right">0.9794624</td>
<td align="right">0.9539887</td>
<td align="right">0.9352989</td>
<td align="right">0.9267977</td>
<td align="right">0.5561734</td>
<td align="right">0.8585989</td>
</tr>
<tr class="even">
<td align="left">Recall</td>
<td align="right">0.7443333</td>
<td align="right">1.0000000</td>
<td align="right">0.8743333</td>
<td align="right">0.8803333</td>
<td align="right">0.9953333</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">F1</td>
<td align="right">0.8422542</td>
<td align="right">0.9761995</td>
<td align="right">0.8947152</td>
<td align="right">0.8928068</td>
<td align="right">0.6826193</td>
<td align="right">0.9199730</td>
</tr>
<tr class="even">
<td align="left">Multivariate selection</td>
<td align="right">0.8873333</td>
<td align="right">1.0000000</td>
<td align="right">0.9230000</td>
<td align="right">0.9210000</td>
<td align="right">0.9186667</td>
<td align="right">0.9990000</td>
</tr>
</tbody>
</table>
<p>When considering the measures of accuracy with univariate one-way ANOVA, we observed that the corrected data from PLSDA-batch and sPLSDA-batch led to higher recall and lower precision than the data from removeBatchEffect and ComBat. However, the precision of sPLSDA-batch was competitive to removeBatchEffect and ComBat. Moreover, sPLSDA-batch achieved higher F1 score and multivariate selection score than removeBatchEffect and ComBat.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## sd</span>
<span class="va">acc_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">precision_limma</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">recall_limma</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>, 
                <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">F1_limma</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">precision_splsda</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">acc_sd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Precision'</span>, <span class="st">'Recall'</span>, <span class="st">'F1'</span>, <span class="st">'Multivariate selection'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">acc_sd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Before correction'</span>, <span class="st">'Ground-truth data'</span>, 
                      <span class="st">'removeBatchEffect'</span>, <span class="st">'ComBat'</span>, 
                      <span class="st">'PLSDA-batch'</span>, <span class="st">'sPLSDA-batch'</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">acc_sd</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="20%">
<col width="16%">
<col width="16%">
<col width="16%">
<col width="8%">
<col width="10%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Before correction</th>
<th align="right">Ground-truth data</th>
<th align="right">removeBatchEffect</th>
<th align="right">ComBat</th>
<th align="right">PLSDA-batch</th>
<th align="right">sPLSDA-batch</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Precision</td>
<td align="right">0.0210738</td>
<td align="right">0.0308522</td>
<td align="right">0.1506673</td>
<td align="right">0.1599417</td>
<td align="right">0.2523071</td>
<td align="right">0.1098712</td>
</tr>
<tr class="even">
<td align="left">Recall</td>
<td align="right">0.0953339</td>
<td align="right">0.0000000</td>
<td align="right">0.0981236</td>
<td align="right">0.0978041</td>
<td align="right">0.0210388</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">F1</td>
<td align="right">0.0647666</td>
<td align="right">0.0163597</td>
<td align="right">0.1180358</td>
<td align="right">0.1240844</td>
<td align="right">0.2003356</td>
<td align="right">0.0682635</td>
</tr>
<tr class="even">
<td align="left">Multivariate selection</td>
<td align="right">0.0613122</td>
<td align="right">0.0000000</td>
<td align="right">0.0680044</td>
<td align="right">0.0689909</td>
<td align="right">0.1227353</td>
<td align="right">0.0052273</td>
</tr>
</tbody>
</table>
<p>The standard deviations of the multivariate selection scores were all smaller than the univariate selection scores for the different corrected data, indicating a better stability of the variables selected by multivariate sPLSDA compared to the one-way ANOVA univariate selection.</p>
</div>
<div id="unbalanced-batch-times-treatment-design" class="section level2">
<h2 class="hasAnchor">
<a href="#unbalanced-batch-times-treatment-design" class="anchor"></a>Unbalanced batch <span class="math inline">\(\times\)</span> treatment design</h2>
<p>The unbalanced design had 4 and 16 samples from batch1 and batch2 respectively in trt1, 16 and 4 samples from batch1 and batch2 in trt2 (see the table below).</p>
<p><strong>Table 3: Unbalanced batch <span class="math inline">\(\times\)</span> treatment design</strong> in the simulation study</p>
<table class="table">
<thead><tr class="header">
<th align="center"></th>
<th align="center">Trt1</th>
<th align="center">Trt2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Batch1</td>
<td align="center">4</td>
<td align="center">16</td>
</tr>
<tr class="even">
<td align="center">Batch2</td>
<td align="center">16</td>
<td align="center">4</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nitr</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">p_total</span> <span class="op">&lt;-</span> <span class="fl">300</span>
<span class="va">p_trt_relevant</span> <span class="op">&lt;-</span> <span class="fl">60</span>
<span class="va">p_bat_relevant</span> <span class="op">&lt;-</span> <span class="fl">150</span>

<span class="co"># global variance (RDA)</span>
<span class="va">gvar.before</span> <span class="op">&lt;-</span> <span class="va">gvar.clean</span> <span class="op">&lt;-</span> <span class="va">gvar.rbe</span> <span class="op">&lt;-</span> <span class="va">gvar.combat</span> <span class="op">&lt;-</span> 
  <span class="va">gvar.wplsdab</span> <span class="op">&lt;-</span> <span class="va">gvar.swplsdab</span> <span class="op">&lt;-</span> <span class="va">gvar.plsdab</span> <span class="op">&lt;-</span> 
  <span class="va">gvar.splsdab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="cn">NA</span>, intersection <span class="op">=</span> <span class="cn">NA</span>, 
                             batch <span class="op">=</span> <span class="cn">NA</span>,  residual <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="co"># individual variance (R2)</span>
<span class="va">r2.trt.before</span> <span class="op">&lt;-</span> <span class="va">r2.trt.clean</span> <span class="op">&lt;-</span> <span class="va">r2.trt.rbe</span>  <span class="op">&lt;-</span> <span class="va">r2.trt.combat</span> <span class="op">&lt;-</span> 
  <span class="va">r2.trt.wplsdab</span> <span class="op">&lt;-</span> <span class="va">r2.trt.swplsdab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">p_total</span>, 
                                                         ncol <span class="op">=</span> <span class="va">nitr</span><span class="op">)</span><span class="op">)</span>
<span class="va">r2.batch.before</span> <span class="op">&lt;-</span> <span class="va">r2.batch.clean</span> <span class="op">&lt;-</span> <span class="va">r2.batch.rbe</span>  <span class="op">&lt;-</span> <span class="va">r2.batch.combat</span> <span class="op">&lt;-</span> 
  <span class="va">r2.batch.wplsdab</span> <span class="op">&lt;-</span> <span class="va">r2.batch.swplsdab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">p_total</span>, 
                                                             ncol <span class="op">=</span> <span class="va">nitr</span><span class="op">)</span><span class="op">)</span>

<span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
<span class="va">precision_limma</span> <span class="op">&lt;-</span> <span class="va">recall_limma</span> <span class="op">&lt;-</span> <span class="va">F1_limma</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>before <span class="op">=</span> <span class="cn">NA</span>, clean <span class="op">=</span> <span class="cn">NA</span>, rbe <span class="op">=</span> <span class="cn">NA</span>, combat <span class="op">=</span> <span class="cn">NA</span>, 
             wplsda_batch <span class="op">=</span> <span class="cn">NA</span>, swplsda_batch <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
<span class="va">precision_splsda</span> <span class="op">&lt;-</span> <span class="va">recall_splsda</span> <span class="op">&lt;-</span> <span class="va">F1_splsda</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>before <span class="op">=</span> <span class="cn">NA</span>, clean <span class="op">=</span> <span class="cn">NA</span>, rbe <span class="op">=</span> <span class="cn">NA</span>, combat <span class="op">=</span> <span class="cn">NA</span>, 
             wplsda_batch <span class="op">=</span> <span class="cn">NA</span>, swplsda_batch <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">nitr</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">### initial setup ###</span>
  <span class="va">simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simData.html">simData</a></span><span class="op">(</span>bat.mean <span class="op">=</span> <span class="fl">7</span>, sd.bat <span class="op">=</span> <span class="fl">8</span>, trt.mean <span class="op">=</span> <span class="fl">3</span>, sd.trt <span class="op">=</span> <span class="fl">2</span>, 
                        N <span class="op">=</span> <span class="fl">40</span>, p_total <span class="op">=</span> <span class="fl">300</span>, p_trt_relevant <span class="op">=</span> <span class="fl">60</span>, 
                        p_bat_relevant <span class="op">=</span> <span class="fl">150</span>, percentage_samples <span class="op">=</span> <span class="fl">0.2</span>,
                        percentage_overlap_variables <span class="op">=</span> <span class="fl">0.5</span>, seeds <span class="op">=</span> <span class="va">i</span><span class="op">)</span>
  
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">data</span>
  <span class="va">trt</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">Y.trt</span>
  <span class="va">batch</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">Y.bat</span>
  <span class="va">true.trt</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">true.trt</span>
  <span class="va">true.batch</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">true.batch</span>
  
  <span class="va">Batch_Trt.factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Batch <span class="op">=</span> <span class="va">batch</span>, Treatment <span class="op">=</span> <span class="va">trt</span><span class="op">)</span>
  
  <span class="co">### Before correction ###</span>
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.before</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.before</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.before</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.before</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.before</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.before</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.before</span>
  <span class="va">r2.batch.before</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.before</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>, design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.before</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.before</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.before</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.before</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.before</span><span class="op">)</span>
  <span class="va">recall_limma.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.before</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.before</span><span class="op">*</span><span class="va">recall_limma.before</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.before</span> <span class="op">+</span> <span class="va">recall_limma.before</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.before</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.before</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.before</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.before</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.before_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.before_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.before</span><span class="op">)</span>
  <span class="va">recall_splsda.before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.before</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.before</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.before</span><span class="op">*</span><span class="va">recall_splsda.before</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.before</span> <span class="op">+</span> <span class="va">recall_splsda.before</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.before</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.before</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### Ground-truth data ###</span>
  <span class="va">X.clean</span> <span class="op">&lt;-</span> <span class="va">simulation</span><span class="op">$</span><span class="va">cleanData</span>
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.clean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.clean</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.clean</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.clean</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.clean</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.clean</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.clean</span>
  <span class="va">r2.batch.clean</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.clean</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.clean</span><span class="op">)</span><span class="op">)</span>, design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.clean</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.clean</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.clean</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.clean</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.clean</span><span class="op">)</span>
  <span class="va">recall_limma.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.clean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.clean</span><span class="op">*</span><span class="va">recall_limma.clean</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.clean</span> <span class="op">+</span> <span class="va">recall_limma.clean</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.clean</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.clean</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.clean</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.clean</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.clean_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.clean</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                             keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.clean_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.clean</span><span class="op">)</span>
  <span class="va">recall_splsda.clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.clean</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.clean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.clean</span><span class="op">*</span><span class="va">recall_splsda.clean</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.clean</span> <span class="op">+</span> <span class="va">recall_splsda.clean</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.clean</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.clean</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### removeBatchEffect corrected data ###</span>
  <span class="va">X.rbe</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/removeBatchEffect.html">removeBatchEffect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, batch <span class="op">=</span> <span class="va">batch</span>, 
                              design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.rbe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.rbe</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.rbe</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.rbe</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.rbe</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.rbe</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.rbe</span>
  <span class="va">r2.batch.rbe</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.rbe</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.rbe</span><span class="op">)</span><span class="op">)</span>, design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.rbe</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.rbe</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.rbe</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.rbe</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.rbe</span><span class="op">)</span>
  <span class="va">recall_limma.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.rbe</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.rbe</span><span class="op">*</span><span class="va">recall_limma.rbe</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.rbe</span> <span class="op">+</span> <span class="va">recall_limma.rbe</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.rbe</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.rbe</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.rbe</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.rbe</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.rbe_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.rbe</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.rbe_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.rbe</span><span class="op">)</span>
  <span class="va">recall_splsda.rbe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.rbe</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.rbe</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.rbe</span><span class="op">*</span><span class="va">recall_splsda.rbe</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.rbe</span> <span class="op">+</span> <span class="va">recall_splsda.rbe</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.rbe</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.rbe</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### ComBat corrected data ###</span>
  <span class="va">X.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sva/man/ComBat.html">ComBat</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, batch <span class="op">=</span> <span class="va">batch</span>, 
                       mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.combat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                       data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.combat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.combat</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.combat</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.combat</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.combat</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.combat</span>
  <span class="va">r2.batch.combat</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.combat</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.combat</span><span class="op">)</span><span class="op">)</span>, design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.combat</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.combat</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.combat</span><span class="op">)</span><span class="op">[</span><span class="va">fit.result.combat</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.combat</span><span class="op">)</span>
  <span class="va">recall_limma.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.combat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.combat</span><span class="op">*</span><span class="va">recall_limma.combat</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.combat</span> <span class="op">+</span> <span class="va">recall_limma.combat</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.combat</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.combat</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.combat</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.combat</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.combat_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.combat</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                              keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.combat_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.combat</span><span class="op">)</span>
  <span class="va">recall_splsda.combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.combat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.combat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.combat</span><span class="op">*</span><span class="va">recall_splsda.combat</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.combat</span> <span class="op">+</span> <span class="va">recall_splsda.combat</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.combat</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.combat</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### wPLSDA-batch corrected data ###</span>
  <span class="va">X.wplsda_batch.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLSDA_batch.html">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, 
                                        Y.trt <span class="op">=</span> <span class="va">trt</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>, 
                                        ncomp.trt <span class="op">=</span> <span class="fl">1</span>, ncomp.bat <span class="op">=</span> <span class="fl">1</span>,
                                        balance <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">X.wplsda_batch</span> <span class="op">&lt;-</span> <span class="va">X.wplsda_batch.correct</span><span class="op">$</span><span class="va">X.nobatch</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X.wplsda_batch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.wplsda_batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.wplsda_batch</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                             data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.wplsdab</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.wplsda_batch</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.wplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.wplsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.wplsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.wplsda_batch</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.wplsda_batch</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.wplsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.wplsda_batch</span>
  <span class="va">r2.batch.wplsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.wplsda_batch</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.wplsda_batch</span><span class="op">)</span><span class="op">)</span>, 
                            design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.wplsda_batch</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.wplsda_batch</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.wplsda_batch</span><span class="op">)</span><span class="op">[</span>
    <span class="va">fit.result.wplsda_batch</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.wplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.wplsda_batch</span><span class="op">)</span>
  <span class="va">recall_limma.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.wplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.wplsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.wplsda_batch</span><span class="op">*</span><span class="va">recall_limma.wplsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.wplsda_batch</span> <span class="op">+</span> <span class="va">recall_limma.wplsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.wplsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.wplsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.wplsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.wplsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.wplsda_batch_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.wplsda_batch</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                                    keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.wplsda_batch_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.wplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.wplsda_batch</span><span class="op">)</span>
  <span class="va">recall_splsda.wplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.wplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.wplsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.wplsda_batch</span><span class="op">*</span><span class="va">recall_splsda.wplsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.wplsda_batch</span> <span class="op">+</span> <span class="va">recall_splsda.wplsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.wplsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.wplsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### swPLSDA-batch corrected data ###</span>
  <span class="va">X.swplsda_batch.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLSDA_batch.html">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, 
                                         Y.trt <span class="op">=</span> <span class="va">trt</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>, 
                                         ncomp.trt <span class="op">=</span> <span class="fl">1</span>, keepX.trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>, 
                                         ncomp.bat <span class="op">=</span> <span class="fl">1</span>, balance <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">X.swplsda_batch</span> <span class="op">&lt;-</span> <span class="va">X.swplsda_batch.correct</span><span class="op">$</span><span class="va">X.nobatch</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X.swplsda_batch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.swplsda_batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.swplsda_batch</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                              data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.swplsdab</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.swplsda_batch</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co"># individual variance (R2)</span>
  <span class="va">indiv.trt.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">indiv.batch.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X.swplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">fit.res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.swplsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">trt</span><span class="op">)</span>
    <span class="va">fit.summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res1</span><span class="op">)</span>
    <span class="va">fit.res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.swplsda_batch</span><span class="op">)</span><span class="op">[</span> ,<span class="va">c</span><span class="op">]</span> <span class="op">~</span> <span class="va">batch</span><span class="op">)</span>
    <span class="va">fit.summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.res2</span><span class="op">)</span>
    <span class="va">indiv.trt.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.trt.swplsda_batch</span>, <span class="va">fit.summary1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
    <span class="va">indiv.batch.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indiv.batch.swplsda_batch</span>, <span class="va">fit.summary2</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">r2.trt.swplsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.trt.swplsda_batch</span>
  <span class="va">r2.batch.swplsdab</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">indiv.batch.swplsda_batch</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">fit.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.swplsda_batch</span><span class="op">)</span><span class="op">)</span>, 
                             design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/contrasts.fit.html">contrasts.fit</a></span><span class="op">(</span><span class="va">fit.swplsda_batch</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fit.result.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">fit.swplsda_batch</span><span class="op">)</span>, number <span class="op">=</span> <span class="va">p_total</span><span class="op">)</span>
  <span class="va">otu.sig.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit.result.swplsda_batch</span><span class="op">)</span><span class="op">[</span>
    <span class="va">fit.result.swplsda_batch</span><span class="op">$</span><span class="va">adj.P.Val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">]</span>
  
  <span class="va">precision_limma.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.swplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.sig.swplsda_batch</span><span class="op">)</span>
  <span class="va">recall_limma.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.sig.swplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_limma.swplsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_limma.swplsda_batch</span><span class="op">*</span><span class="va">recall_limma.swplsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_limma.swplsda_batch</span> <span class="op">+</span> <span class="va">recall_limma.swplsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">precision_limma.swplsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">precision_limma.swplsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_limma.swplsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_limma.swplsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">fit.swplsda_batch_splsda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X.swplsda_batch</span>, Y <span class="op">=</span> <span class="va">trt</span>, ncomp <span class="op">=</span> <span class="fl">1</span>, 
                                     keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span><span class="op">)</span>
  <span class="va">otu.dcn.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fit.swplsda_batch_splsda</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  
  <span class="va">precision_splsda.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.swplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">otu.dcn.swplsda_batch</span><span class="op">)</span>
  <span class="va">recall_splsda.swplsda_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">otu.dcn.swplsda_batch</span><span class="op">)</span><span class="op">)</span><span class="op">/</span>
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>
  <span class="va">F1_splsda.swplsda_batch</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">precision_splsda.swplsda_batch</span><span class="op">*</span><span class="va">recall_splsda.swplsda_batch</span><span class="op">)</span><span class="op">/</span>
    <span class="op">(</span><span class="va">precision_splsda.swplsda_batch</span> <span class="op">+</span> <span class="va">recall_splsda.swplsda_batch</span><span class="op">)</span>
  
  <span class="co">## replace NA value with 0</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">F1_splsda.swplsda_batch</span> <span class="op">==</span> <span class="st">'NaN'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">F1_splsda.swplsda_batch</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="op">}</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### PLSDA-batch corrected data ###</span>
  <span class="va">X.plsda_batch.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLSDA_batch.html">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, 
                                       Y.trt <span class="op">=</span> <span class="va">trt</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>, 
                                       ncomp.trt <span class="op">=</span> <span class="fl">1</span>, ncomp.bat <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">X.plsda_batch</span> <span class="op">&lt;-</span> <span class="va">X.plsda_batch.correct</span><span class="op">$</span><span class="va">X.nobatch</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.plsda_batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.plsda_batch</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>, 
                            data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.plsdab</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.plsda_batch</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  <span class="co">###############################################################################################</span>
  <span class="co">### sPLSDA-batch corrected data ###</span>
  <span class="va">X.splsda_batch.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLSDA_batch.html">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, 
                                        Y.trt <span class="op">=</span> <span class="va">trt</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>, 
                                        ncomp.trt <span class="op">=</span> <span class="fl">1</span>, keepX.trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">true.trt</span><span class="op">)</span>, 
                                        ncomp.bat <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">X.splsda_batch</span> <span class="op">&lt;-</span> <span class="va">X.splsda_batch.correct</span><span class="op">$</span><span class="va">X.nobatch</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>
  
  <span class="co"># global variance (RDA)</span>
  <span class="va">rda.splsda_batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html">varpart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X.splsda_batch</span><span class="op">)</span>, <span class="op">~</span> <span class="va">Treatment</span>, <span class="op">~</span> <span class="va">Batch</span>,
                             data <span class="op">=</span> <span class="va">Batch_Trt.factors</span><span class="op">)</span>
  <span class="va">gvar.splsdab</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.splsda_batch</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span>
  
  
  <span class="co"># summary</span>
  <span class="co"># precision &amp; recall &amp; F1 (ANOVA)</span>
  <span class="va">precision_limma</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">precision_limma.before</span>, 
                            `Ground-truth data` <span class="op">=</span> <span class="va">precision_limma.clean</span>,
                            `removeBatchEffect` <span class="op">=</span> <span class="va">precision_limma.rbe</span>,
                            ComBat <span class="op">=</span> <span class="va">precision_limma.combat</span>,
                            `wPLSDA-batch` <span class="op">=</span> <span class="va">precision_limma.wplsda_batch</span>,
                            `swPLSDA-batch` <span class="op">=</span> <span class="va">precision_limma.swplsda_batch</span><span class="op">)</span>
  
  <span class="va">recall_limma</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">recall_limma.before</span>, 
                         `Ground-truth data` <span class="op">=</span> <span class="va">recall_limma.clean</span>,
                         `removeBatchEffect` <span class="op">=</span> <span class="va">recall_limma.rbe</span>,
                         ComBat <span class="op">=</span> <span class="va">recall_limma.combat</span>,
                         `wPLSDA-batch` <span class="op">=</span> <span class="va">recall_limma.wplsda_batch</span>,
                         `swPLSDA-batch` <span class="op">=</span> <span class="va">recall_limma.swplsda_batch</span><span class="op">)</span>
  
  <span class="va">F1_limma</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">F1_limma.before</span>, 
                     `Ground-truth data` <span class="op">=</span> <span class="va">F1_limma.clean</span>,
                     `removeBatchEffect` <span class="op">=</span> <span class="va">F1_limma.rbe</span>,
                     ComBat <span class="op">=</span> <span class="va">F1_limma.combat</span>,
                     `wPLSDA-batch` <span class="op">=</span> <span class="va">F1_limma.wplsda_batch</span>,
                     `swPLSDA-batch` <span class="op">=</span> <span class="va">F1_limma.swplsda_batch</span><span class="op">)</span>
  
  
  <span class="co"># precision &amp; recall &amp; F1 (sPLSDA)</span>
  <span class="va">precision_splsda</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">precision_splsda.before</span>, 
                             `Ground-truth data` <span class="op">=</span> <span class="va">precision_splsda.clean</span>,
                             `removeBatchEffect` <span class="op">=</span> <span class="va">precision_splsda.rbe</span>,
                             ComBat <span class="op">=</span> <span class="va">precision_splsda.combat</span>,
                             `wPLSDA-batch` <span class="op">=</span> <span class="va">precision_splsda.wplsda_batch</span>,
                             `swPLSDA-batch` <span class="op">=</span> <span class="va">precision_splsda.swplsda_batch</span><span class="op">)</span>
  
  <span class="va">recall_splsda</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">recall_splsda.before</span>, 
                          `Ground-truth data` <span class="op">=</span> <span class="va">recall_splsda.clean</span>,
                          `removeBatchEffect` <span class="op">=</span> <span class="va">recall_splsda.rbe</span>,
                          ComBat <span class="op">=</span> <span class="va">recall_splsda.combat</span>,
                          `wPLSDA-batch` <span class="op">=</span> <span class="va">recall_splsda.wplsda_batch</span>,
                          `swPLSDA-batch` <span class="op">=</span> <span class="va">recall_splsda.swplsda_batch</span><span class="op">)</span>
  
  <span class="va">F1_splsda</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">F1_splsda.before</span>, 
                      `Ground-truth data` <span class="op">=</span> <span class="va">F1_splsda.clean</span>,
                      `removeBatchEffect` <span class="op">=</span> <span class="va">F1_splsda.rbe</span>,
                      ComBat <span class="op">=</span> <span class="va">F1_splsda.combat</span>,
                      `wPLSDA-batch` <span class="op">=</span> <span class="va">F1_splsda.wplsda_batch</span>,
                      `swPLSDA-batch` <span class="op">=</span> <span class="va">F1_splsda.swplsda_batch</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
</div>
<div id="figures-1" class="section level2">
<h2 class="hasAnchor">
<a href="#figures-1" class="anchor"></a>Figures</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># global variance (RDA)</span>
<span class="va">prop.gvar.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.before</span><span class="op">)</span>,
                       `Ground-truth data` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.clean</span><span class="op">)</span>,
                       removeBatchEffect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.rbe</span><span class="op">)</span>,
                       ComBat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.combat</span><span class="op">)</span>,
                       `wPLSDA-batch` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.wplsdab</span><span class="op">)</span>,
                       `swPLSDA-batch` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.swplsdab</span><span class="op">)</span>,
                       `PLSDA-batch` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.plsdab</span><span class="op">)</span>,
                       `sPLSDA-batch` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">gvar.splsdab</span><span class="op">)</span><span class="op">)</span>

<span class="va">prop.gvar.all</span><span class="op">[</span><span class="va">prop.gvar.all</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">prop.gvar.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">prop.gvar.all</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">prop.gvar.all</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Treatment'</span>, <span class="st">'Intersection'</span>, <span class="st">'Batch'</span>, <span class="st">'Residuals'</span><span class="op">)</span>

<span class="fu"><a href="../reference/partVar_plot.html">partVar_plot</a></span><span class="op">(</span>prop.df <span class="op">=</span> <span class="va">prop.gvar.all</span><span class="op">)</span></code></pre></div>
<p><img src="simulation_study_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>With an unbalanced batch <span class="math inline">\(\times\)</span> treatment design, we observed that certain amount of variance was shared (intersection) and explained by both batch and treatment effects. Such intersectional variance should exist even in the ground-truth data with no batch effect, as it originates from treatment variation because of the unbalanced design. Unweighted PLSDA-batch and sPLSDA-batch failed in such design, as their corrected data still included a large amount of batch variation (PLSDA-batch) or not included intersectional variance (sPLSDA-batch), while the other methods removed batch variation successfully. The corrected data from removeBatchEffect and ComBat included less proportion of variance explained by treatment but more intersectional variance compared to the ground-truth data. Although wPLSDA-batch corrected data included the largest treatment variance, swPLSDA-batch outperformed all methods with results similar to the ground-truth data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">################################################################################################</span>
<span class="co"># individual variance (R2)</span>
<span class="co"># color</span>
<span class="va">gcolor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span>, <span class="va">p_trt_relevant</span><span class="op">)</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span>, <span class="op">(</span><span class="va">p_total</span> <span class="op">-</span> <span class="va">p_trt_relevant</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">gcolor</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">true.batch</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span>
<span class="va">gcolor</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">p_total</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">true.trt</span>, <span class="va">true.batch</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>

<span class="va">xlabs</span> <span class="op">=</span> <span class="st">'R2(variable, treatment)'</span>
<span class="va">ylabs</span> <span class="op">=</span> <span class="st">'R2(variable, batch)'</span>
<span class="va">edgex</span> <span class="op">=</span> <span class="fl">0.7</span>
<span class="va">edgey</span> <span class="op">=</span> <span class="fl">0.6</span>

<span class="co"># scatterplot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.before</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.before</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'Before correction'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.clean</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.clean</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'Ground-truth data'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.rbe</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.rbe</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'removeBatchEffect'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.combat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.combat</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'ComBat'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.wplsdab</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.wplsdab</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'wPLSDA-batch'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.trt.swplsdab</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">r2.batch.swplsdab</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">gcolor</span>, 
     xlab <span class="op">=</span> <span class="va">xlabs</span>, ylab <span class="op">=</span> <span class="va">ylabs</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gcolor</span><span class="op">)</span><span class="op">)</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgex</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">edgey</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'swPLSDA-batch'</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'No effect'</span>, <span class="st">'Treatment only'</span>, 
                              <span class="st">'Batch only'</span>, <span class="st">'Treatment &amp; batch'</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="../reference/pb_color.html">pb_color</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="simulation_study_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Based on the <span class="math inline">\(R^2\)</span> values, variables assigned with both treatment and batch effects were segregated into two groups depending on whether their abundance increased or decreased consistently or not according to the two effects. We observed similar results to those obtained from the balanced design.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># precision &amp; recall &amp; F1 (ANOVA &amp; sPLSDA)</span>
<span class="co">## mean</span>
<span class="va">acc_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">precision_limma</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">recall_limma</span><span class="op">)</span>, 
                  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">F1_limma</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">precision_splsda</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">acc_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Precision'</span>, <span class="st">'Recall'</span>, <span class="st">'F1'</span>, <span class="st">'Multivariate selection'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">acc_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Before correction'</span>, <span class="st">'Ground-truth data'</span>, 
                        <span class="st">'removeBatchEffect'</span>, <span class="st">'ComBat'</span>, 
                        <span class="st">'wPLSDA-batch'</span>, <span class="st">'swPLSDA-batch'</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">acc_mean</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="20%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="8%">
<col width="11%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Before correction</th>
<th align="right">Ground-truth data</th>
<th align="right">removeBatchEffect</th>
<th align="right">ComBat</th>
<th align="right">wPLSDA-batch</th>
<th align="right">swPLSDA-batch</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Precision</td>
<td align="right">0.5176169</td>
<td align="right">0.9570625</td>
<td align="right">0.8465093</td>
<td align="right">0.7988611</td>
<td align="right">0.5191056</td>
<td align="right">0.7977674</td>
</tr>
<tr class="even">
<td align="left">Recall</td>
<td align="right">0.7246667</td>
<td align="right">1.0000000</td>
<td align="right">0.8630000</td>
<td align="right">0.8613333</td>
<td align="right">0.9930000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">F1</td>
<td align="right">0.5536925</td>
<td align="right">0.9777991</td>
<td align="right">0.8405130</td>
<td align="right">0.8083799</td>
<td align="right">0.6545839</td>
<td align="right">0.8806854</td>
</tr>
<tr class="even">
<td align="left">Multivariate selection</td>
<td align="right">0.7283333</td>
<td align="right">1.0000000</td>
<td align="right">0.8756667</td>
<td align="right">0.8700000</td>
<td align="right">0.8856667</td>
<td align="right">0.9940000</td>
</tr>
</tbody>
</table>
<p>When considering the measures of accuracy with univariate one-way ANOVA, we observed that the corrected data from wPLSDA-batch and swPLSDA-batch led to higher recall and lower precision than the data from removeBatchEffect and ComBat. However, the precision of swPLSDA-batch was competitive to removeBatchEffect and ComBat. Moreover, weighted sPLSDA-batch achieved higher F1 score and multivariate selection score than removeBatchEffect and ComBat.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## sd</span>
<span class="va">acc_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">precision_limma</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">recall_limma</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>, 
                <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">F1_limma</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">precision_splsda</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">acc_sd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Precision'</span>, <span class="st">'Recall'</span>, <span class="st">'F1'</span>, <span class="st">'Multivariate selection'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">acc_sd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Before correction'</span>, <span class="st">'Ground-truth data'</span>, 
                      <span class="st">'removeBatchEffect'</span>, <span class="st">'ComBat'</span>, 
                      <span class="st">'wPLSDA-batch'</span>, <span class="st">'swPLSDA-batch'</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">acc_sd</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="20%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="8%">
<col width="11%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Before correction</th>
<th align="right">Ground-truth data</th>
<th align="right">removeBatchEffect</th>
<th align="right">ComBat</th>
<th align="right">wPLSDA-batch</th>
<th align="right">swPLSDA-batch</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Precision</td>
<td align="right">0.3245476</td>
<td align="right">0.0313626</td>
<td align="right">0.1755439</td>
<td align="right">0.2312812</td>
<td align="right">0.2322613</td>
<td align="right">0.1371355</td>
</tr>
<tr class="even">
<td align="left">Recall</td>
<td align="right">0.0422228</td>
<td align="right">0.0000000</td>
<td align="right">0.1038537</td>
<td align="right">0.1003079</td>
<td align="right">0.0287869</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">F1</td>
<td align="right">0.2116514</td>
<td align="right">0.0166306</td>
<td align="right">0.1368551</td>
<td align="right">0.1769684</td>
<td align="right">0.1889568</td>
<td align="right">0.0915083</td>
</tr>
<tr class="even">
<td align="left">Multivariate selection</td>
<td align="right">0.0505357</td>
<td align="right">0.0000000</td>
<td align="right">0.0688593</td>
<td align="right">0.0830266</td>
<td align="right">0.1482708</td>
<td align="right">0.0157071</td>
</tr>
</tbody>
</table>
<p>The standard deviations of the multivariate selection scores were all smaller than the univariate selection scores for the different corrected data, indicating a better stability of the variables selected by multivariate sPLSDA compared to the one-way ANOVA univariate selection.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-singh2019diablo" class="csl-entry">
Singh, Amrit, Casey P Shannon, Benoı̂t Gautier, Florian Rohart, Michaël Vacher, Scott J Tebbutt, and Kim-Anh Lê Cao. 2019. <span>“DIABLO: An Integrative Approach for Identifying Key Molecular Drivers from Multi-Omics Assays.”</span> <em>Bioinformatics</em> 35 (17): 3055–62.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Yiwen Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
